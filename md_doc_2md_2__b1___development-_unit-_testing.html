<!-- HTML header for doxygen 1.9.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libDaisy: Development - Unit-Testing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" type="image/x-icon" href="ES_Circle_Orange.PNG">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo">
    <a href="index.html"><img alt="Logo" src="DaisyLogo.png"/></a>
  </td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libDaisy
   </div>
   <div id="projectbrief">Hardware Library for Daisy</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_doc_2md_2__b1___development-_unit-_testing.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Development - Unit-Testing</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md63"></a> libDaisy has integrated unit tests.</p>
<ul>
<li>Unit tests are small tests that verify that a piece of code works as intended.</li>
<li>Unit tests are compiled into a small application that runs on your development computer. They're not compiled into libDaisy.</li>
<li>Unit tests are run as part of the continuous integration (CI) setup. They're build and executed with each pull request, making sure that the changes don't break existing functionality.</li>
<li>Unit tests in libDaisy are based on the widely used <a href="https://google.github.io/googletest/primer.html">googletest framework</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md64"></a>
Why write tests?</h1>
<p>Writing a test can help you in many ways. Here are some of the many benefits:</p>
<ul>
<li>With unit tests in place, we can modify existing code without fear. If there's a test and its green, you can feel safe.</li>
<li>Unit tests give you a great, simple environment to quickly run and test your code with a debugger. Not only does a test work independently from the hardware, it also gives you a clean, blank slate that's easy to setup so that you can quickly check out a particular scenario. Want to quickly try out that idea you had earlier? No need to setup a hardware testbed! Just add a small test and off you go!</li>
<li>In writing the tests for new code, you force yourself to really think about what your code is supposed and not supposed to do. This helps you split a new functionality into small, independent parts that serve a well defined purpose. Additionally, the test itself is the best documentation. It clearly states how the code should behave.</li>
</ul>
<h1><a class="anchor" id="autotoc_md65"></a>
How to run tests?</h1>
<p>Update the git submodules so that the googletest code is checked out. </p><pre class="fragment">&gt; git submodule update --init --recursive
</pre><p> Linux:</p>
<ul>
<li>Install the <code>build-essential</code> package. That's it.</li>
</ul>
<p>macOS:</p>
<ul>
<li>Install Xcode and the Xcode commandline tools.</li>
</ul>
<p>Windows:</p>
<ul>
<li>Install Cygwin with the packages <code>g++</code>, <code>gdb</code> and <code>make</code>. Add them to your PATH environment variable. <a href="https://www.cs.odu.edu/~zeil/cs250PreTest/latest/Public/installingACompiler/#installing-the-cygwin-compiler">This guide may be helpful for you</a>.</li>
</ul>
<h2><a class="anchor" id="autotoc_md66"></a>
From the commandline</h2>
<p>All tests live in the <code>tests/</code> directory and share a common makefile. To build and run the tests, execute this:</p>
<div class="fragment"><div class="line">&gt; cd tests/</div>
<div class="line">&gt; make test</div>
</div><!-- fragment --><p> This generates and runs a small commandline program <code>tests/libDaisy_gtest</code>.</p>
<h2><a class="anchor" id="autotoc_md67"></a>
From Visual Studio Code</h2>
<p>Programmers using Visual Studio Code can install the recommended extensions (you will be prompted to do so) and use the test panel to directly run the tests. Take a look at the screenshot below:</p>
<p><img src="../images/vscode-test-panel.png" alt="Visual Studio Code test panel" class="inline"/></p>
<ul>
<li>Build tests by executing the <code>build-libDaisy-tests</code> task with <code>Ctrl-Shift-B</code> (Win) or <code>Cmd-Shift-B</code> (macOS).</li>
<li>Run and debug individual tests or entire test suites from the test panel. (see screenshot)</li>
<li>Launch the tests from the launch tab with the <code>Launch Tests Locally</code> launch configuration.</li>
</ul>
<h1><a class="anchor" id="autotoc_md68"></a>
Getting started with unit testing</h1>
<p>Adding a new test to libDaisy is easy.</p>
<ol type="1">
<li>Add a new <code>*_gtest.cpp</code> file to the <code>tests/</code> directory. This is where you will write your tests. It makes sense to create individual files for each component you want to test.</li>
<li>In this file, include the googletest header <code>#include &lt;gtest/gtest.h&gt;</code></li>
<li>Also include the code you want to test <code>#include "myHeaderFileFromLibDaisy.h"</code></li>
<li>If your code also has a <code>*.cpp</code> file, include that in the file <code>tests/libDaisyImpls.cpp</code> like this: <code>#include "myCppFileFromLibDaisy.cpp"</code></li>
<li>Add a test to your fresh new <code>*_gtest.cpp</code> file.</li>
</ol>
<p>This is what a simple test could look like:</p>
<div class="fragment"><div class="line"><span class="comment">// tests/myTest_gtest.cpp</span></div>
<div class="line"><span class="preprocessor">#include &lt;gtest/gtest.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;myHeaderFileFromLibDaisy.h&quot;</span></div>
<div class="line"> </div>
<div class="line">TEST(MyTestSuiteName, a_myFirstTest)</div>
<div class="line">{</div>
<div class="line">    EXPECT_EQ(2, 6 - 4);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST(MyTestSuiteName, b_mySecondTest)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> someResult = 2 == 2;</div>
<div class="line">    EXPECT_TRUE(someResult);</div>
<div class="line">}</div>
</div><!-- fragment --><p>For more examples, check out the existing tests and take a look at the <a href="https://google.github.io/googletest/primer.html">official googletest primer</a>.</p>
<h1><a class="anchor" id="autotoc_md69"></a>
Drawbacks &amp; things to watch out for</h1>
<p>Tests are built locally on your development computer. While that enables you to build and test without hardware, it comes with a couple of drawbacks that you should be aware of:</p>
<ul>
<li>Any code that uses features specific to the hardware can't be unit tested. This includes<ul>
<li>Code that uses inline assembly</li>
<li>Code that relies on hardware peripherals</li>
</ul>
</li>
<li>The unit test makefile is setup so that the <code>UNIT_TEST</code> macro is defined whenever code is compiled for unit tests. You can use this to replace actual hardware dependent code with a dummy version.<ul>
<li>Let's assume you want to write tests for <code><a class="el" href="led_8h.html">src/hid/led.h</a></code>.</li>
<li>This file will include <code><a class="el" href="gpio_8h.html">src/per/gpio.h</a></code> which obviously can't work natively on your development computer.</li>
<li>To resolve this issue, you could use the preprocessor macro <code>UNIT_TEST</code> to selectively replace the problematic gpio code with a dummy version that you can control and observe from your unit tests.</li>
</ul>
</li>
</ul>
<p>Should you face issues with native code that won't compile in unit tests, feel free to ask on the <a href="https://forum/electro-smith.com">forums</a> or in <a href="https://join.slack.com/t/es-daisy/shared_invite/zt-f9cfm1g4-DgdCok1h1Rj4fpX90~IOww">Slack</a>! We're there to help! </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath">
  <!-- id is needed for treeview function! -->
  <ul>
  </ul>
</div>
<script type="text/javascript">
  // script for doxygen 1.9.2
  $(function () {
    toggleButton = document.createElement('doxygen-awesome-dark-mode-toggle')
    toggleButton.title = "Toggle Light/Dark Mode"
    $(document).ready(function () {
      document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
    })
    $(window).resize(function () {
      document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
    })
  })
</script>
</body>
</html>