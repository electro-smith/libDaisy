<!-- HTML header for doxygen 1.9.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libDaisy: Getting Started - External SDRAM</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" type="image/x-icon" href="ES_Circle_Orange.PNG">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo">
    <a href="index.html"><img alt="Logo" src="DaisyLogo.png"/></a>
  </td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libDaisy
   </div>
   <div id="projectbrief">Hardware Library for Daisy</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_doc_2md_2__a6___getting-_started-_external-_s_d_r_a_m.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Getting Started - External SDRAM</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md42"></a> </p>
<h1><a class="anchor" id="autotoc_md43"></a>
Usage</h1>
<p>The Daisy comes with 64MB of external memory in addition to it's 1MB of internal memory</p>
<p>This is extremely valuable for DSP effects like delays, sample-based synthesis, and more.</p>
<p>The external memory, however, does require a little bit of special handling to use.</p>
<p>Let's first look at a normal array of floats. Something we might use for a buffer or delay:</p>
<div class="fragment"><div class="line"><span class="keywordtype">float</span> my_buffer[1024];</div>
</div><!-- fragment --><p>So that's 1024 floats in an array within our normal memory. Totalling 4kB of memory. This will easily fit in any of the memory regions available on the Daisy.</p>
<p>You can declare that anywhere and do anything with it.</p>
<p>Well, the SDRAM is a little bit different.</p>
<p>Due to the way the SDRAM is handled, an object located within it has to be created globally (at least the easy way), and it can't have a constructor of any importance (a C++ construct that happens before the SDRAM is fuly initialized).</p>
<p>Now, for most things (like buffers, arrays, etc.) this doesn't matter much.</p>
<p>So, let's make the same array again, but in the SDRAM:</p>
<div class="fragment"><div class="line"><span class="keywordtype">float</span> __attribute__(section((<span class="stringliteral">&quot;.sdram_bss&quot;</span>))) my_buffer[1024];</div>
</div><!-- fragment --><p>Now, that is a lot of stuff to type, and pretty hard to remember. So we made a shorthand macro to make it a bit easier:</p>
<div class="fragment"><div class="line"><span class="keywordtype">float</span> <a class="code hl_define" href="group__sdram.html#gaf0d907706b8822fa9d7dafcd174806fe">DSY_SDRAM_BSS</a> my_buffer[1024];</div>
<div class="ttc" id="agroup__sdram_html_gaf0d907706b8822fa9d7dafcd174806fe"><div class="ttname"><a href="group__sdram.html#gaf0d907706b8822fa9d7dafcd174806fe">DSY_SDRAM_BSS</a></div><div class="ttdeci">#define DSY_SDRAM_BSS</div><div class="ttdef"><b>Definition</b> sdram.h:81</div></div>
</div><!-- fragment --><p>The first, longform example is the spelled out compiler attribute that says what memory section to put the array in. This can be useful on big projects when using one of the many other available memory sections within the STM32H7 processor.</p>
<p>However, for now, we don't need to worry much about that, and can just use the <code>DSY_SDRAM_BSS</code> macro.</p>
<p>Now, when you use this memory it's initial condition is undefined, meaning it could be zeroes, or it could be whatever it was last if you only turned the board off for a few milliseconds, or did a software RESET.</p>
<p>Beyond that, this memory operates in much the same way as normal memory, just a little bit slower. For most things this won't be noticeable, but if you're trying to do extreme-granular-wavetable super-synthesis, you may have to pay attention to what memory you're using.</p>
<h1><a class="anchor" id="autotoc_md44"></a>
Addressing</h1>
<p>The SDRAM is memory-mapped to <code>0xC0000000</code>. So if you're using pointers, or want to create some sort of dynamic allocator of some kind, that would be the base address of the SDRAM. It is totally usable across it's range. Just keep in mind some of the limitations mentioned above.</p>
<h1><a class="anchor" id="autotoc_md45"></a>
Initialization</h1>
<p>Most objects that might expect SDRAM memory within libDaisy, or more-often DaisySP, use <code>Init</code> functions meant to be called after the <code>DaisySeed::Init</code> to fill the memory with expected data. If you're building your own looper, sampler, delay, etc. you'll want to make sure to zero, or fill the SDRAM allocated buffer <em>after</em> within a function that can be called from the Init function instead of during a constructor.</p>
<h1><a class="anchor" id="autotoc_md46"></a>
Class Design with Large Memory</h1>
<p>The simplest way to allow for a huge chunk of memory to be use an external buffer type of some sort.</p>
<p>The most rudimentary method of doing so would look something like:</p>
<div class="fragment"><div class="line">MyClass::Init(<span class="keywordtype">float</span>* buffer, <span class="keywordtype">size_t</span> size);</div>
<div class="line"> </div>
<div class="line">. . .</div>
<div class="line">float *internal_buffer_;</div>
</div><!-- fragment --><p>Where a float buffer can be declared of any size, in any memory region, and passed in at init-time.</p>
<h1><a class="anchor" id="autotoc_md47"></a>
Future Work</h1>
<p>There are plans to initialize the SDRAM during startup to allow access via constructors, or as the default heap, etc.</p>
<p>So these limitations are not set in stone. Check in the <a href="https://github.com/electro-smith/libDaisy/releases">Release Notes</a>, and the <a href="https://forum.electro-smith.com">Forum</a> for updates in the future. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath">
  <!-- id is needed for treeview function! -->
  <ul>
  </ul>
</div>
<script type="text/javascript">
  // script for doxygen 1.9.2
  $(function () {
    toggleButton = document.createElement('doxygen-awesome-dark-mode-toggle')
    toggleButton.title = "Toggle Light/Dark Mode"
    $(document).ready(function () {
      document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
    })
    $(window).resize(function () {
      document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
    })
  })
</script>
</body>
</html>